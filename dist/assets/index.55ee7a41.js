import{L as e}from"./vendor.427851ec.js";let t=null,n=null,o=null,r=null;const s={},i=(e,t)=>({key:e,label:t}),a=[i("num_dep","Département"),i("code_naf","Code NAF"),i("lib_naf","Libéllé NAF"),i("regime","Code Régime"),i("lib_regime","Libéllé Regime"),i("lib_seveso","Libéllé SEVESO"),i("famille_ic","Famille IC")],c=["lib_naf","famille_ic","nom_ets","nomcommune"];let l={},p=null,m=!1,u=0,f=500;function b(){m=!1,u=0,t&&t.remove(),t=e.geoJSON(o.features,{pointToLayer:function(t,n){return e.marker(n,{icon:r})},filter:function(t,o){const r=t.properties,s=Object.entries(l);if(u>=f)return m=!0,!1;if(p&&""!==p&&p.length>=3){let e=!1;for(const t of c)if(r[t].match(new RegExp(p,"ig"))){e=!0;break}if(!e)return!1}const i=t.geometry.coordinates,a=e.latLng(i[1],i[0]);if(!n.getBounds().contains(a))return!1;for(const[e,n]of s)if(""!==n&&r[e]!==n)return!1;return u++,!0},onEachFeature:function(e,t){let n="";e.properties&&(e.properties.nom_ets&&(n+=`<b>${e.properties.nom_ets}</b> <br />`),e.properties.lib_naf&&(n+=`${e.properties.lib_naf} <br />`),e.properties.famille_ic&&(n+=`${e.properties.famille_ic}  <br />`),e.properties.lib_seveso&&(n+=`${e.properties.lib_seveso}  <br />`),e.properties.nomcommune&&(n+=`${e.properties.nomcommune}  <br />`),e.properties.url_fiche&&(n+=`<br /><a target="_blank" href=${e.properties.url_fiche}> voir fiche </a>`)),t.bindPopup(n)}}).addTo(n);const s=t.getLayers().length;document.querySelector(".pinNumber").innerHTML=`\n            <p class="search-result">\n                Résultat de recherche: <b>${s}</b> entrée(s)\n                ${m?"<br /><br /><b>(Par soucis de performance, tous les élements ne sont pas afficher. Zoomer pour voir plus)</b> <br />":""}\n                <button class="addMaxTotal"> +500 </button>                \n            </p>\n        `,document.querySelector(".addMaxTotal").addEventListener("click",(()=>f+=500))}!async function(){await async function(){o=await(await fetch("/icpe/assets/data/icpe.geo.json")).json(),o.features=o.features.sort((()=>Math.random()-.5))}(),function(){for(const{key:e,label:t}of a){const n={};for(const t of o.features)n[t.properties[e]]=!0;s[e]={label:t,items:Object.keys(n).sort()},""!==s[e].items[0]&&s[e].items.unshift("")}}(),function(){let e="";e+="\n        <fieldset class=\"search-bar\">\n            <label>Recherche </label><input type='text' class='search' />\n        </fieldset>\n        <p class=\"filters-title\">\n          Filtres\n        </p>\n    ";for(const[n,{label:o,items:r}]of Object.entries(s)){let t="";for(const e of r)t+=`<option>${e}</option>`;e+=`\n            <fieldset>\n                <label>${o}</label>\n                <select name="${n}">${t}</select>\n            </fieldset>\n        `}e+="\n        <button class='reset'>\n            Réinitialiser\n        </button>    \n\n        <div class=\"pinNumber\">\n        </div>\n    ",document.querySelector(".filters").innerHTML=e,document.querySelectorAll("select").forEach((e=>{e.addEventListener("change",(t=>{const n=e.getAttribute("name");l[n]=e.value.trim(),b()}))}));const t=document.querySelector(".search");t.addEventListener("focusout",(()=>{const e=t.value.trim();p=e,b()})),t.addEventListener("keypress",(e=>{if(13===e.keyCode){const e=t.value.trim();p=e,b()}})),document.querySelector(".reset").addEventListener("click",(()=>{l={},f=500,b()}))}(),r=e.icon({iconUrl:"/icpe/assets/img/map-marker-icon.png",iconSize:[32,32],shadowSize:[50,64],iconAnchor:[32,32],shadowAnchor:[4,62],popupAnchor:[-16,-32]}),n=e.map("mapid").setView([48.393011982751744,-2.6470516079040847],13),e.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoieW1lbmFyZC1kZXYiLCJhIjoiY2twZWc3emZtMGxzYTJubzhyZnp6ZHJveSJ9.ub0yDhdRQ-dWyKBs7KR1wQ"}).addTo(n),n.on("zoomend",b),n.on("moveend",b),b()}();
